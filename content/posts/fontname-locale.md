---
title: "WPSä¸­çš„å­—ä½“å"
date: 2019-01-14T18:31:08+08:00
---

ä»Šå¤©åˆè¢«  `fontconfig` å‘åˆ°äº†â€¦â€¦ä»”ç»†æƒ³æƒ³ï¼ŒåŠå¹´åˆ°ä¸€å¹´å‰æˆ‘è¿˜å¯¹ `fontconfig`  ç‹—å±ä¸é€šå‘¢ï¼Œè€Œç°åœ¨æˆ‘å·²ç»è¢« `fontconfit` å‘äº†æœ‰å‡ æ¬¡äº†ï¼Œè¿™å°è¯äº†ä¸€ä¸ªçœŸç†ï¼šâ€œåªè¦ä½ è¶³å¤Ÿè¿Ÿé’ï¼Œä¸–ç•Œå°±æ˜¯ç¾å¥½çš„ï¼Œä¸€æ—¦ä½ æœ‰äº†æŸç§èƒ½åŠ›ï¼Œéº»çƒ¦å°±ä¼šæ‰¾åˆ°ä½ â€â€”â€”è¿™åªæ˜¯ä¸ªç©ç¬‘ï¼Œäº‹å®ä¸Šä¸ç®¡ä½ æœ‰æ²¡æœ‰èƒ½åŠ›ï¼Œç°å®éƒ½ä¸ä¼šè®©ä½ å¥½è¿‡ ğŸ˜ˆ

åœ¨è¿™äº›å‘é‡Œé¢ï¼Œæœ‰ä¸¤ä¸ªæ˜¯è·Ÿä»Šå¤©ä¸»é¢˜ç›¸å…³çš„ï¼Œä¹Ÿå°±æ˜¯å…³äºWPSä¸­å­—ä½“åç§°çš„ä¸¤ä¸ªé—®é¢˜ï¼š

- WPS å­—ä½“åˆ—è¡¨ä¸­ä¸­æ–‡å­—ä½“åœ¨ä¸­æ–‡ç¯å¢ƒä¸‹ä¸æ˜¾ç¤ºä¸­æ–‡åï¼ˆæ¯”å¦‚ç³»ç»Ÿé‡Œé¢æœ‰å®‹ä½“ï¼Œåˆ—è¡¨é‡Œé¢æ˜¾ç¤º `SimSun`ï¼‰ï¼›
- WPS è®¾ç½®æ®µè½å­—ä½“ï¼ˆä¸­æ–‡å­—ä½“ï¼‰åï¼Œå·¥å…·æ æ˜¾ç¤ºçš„å­—ä½“ä¸ºè‹±æ–‡åï¼ˆæ¯”å¦‚ä½ è®¾ç½®ä¸€æ®µæ–‡å­—æ˜¯å®‹ä½“ï¼Œä½†æ˜¯æ ‡é¢˜æ æ˜¾ç¤ºçš„ä»ç„¶æ˜¯`SimSun`ï¼‰

è¿™ä¸¤ä¸ªé—®é¢˜æœ‰ç‚¹åƒï¼Œä½†æ˜¯å´ä¸æ˜¯åŒä¸€ä¸ªé—®é¢˜ï¼ˆä¹Ÿä¸åªæ˜¯WPSæœ‰é—®é¢˜ï¼Œè€Œæ˜¯WPSå¯¹å­—ä½“çš„éœ€æ±‚æ¯”è¾ƒå¤šï¼‰ï¼š

ç¬¬ä¸€ä¸ªé—®é¢˜åŸå…ˆæ˜¯ [è®ºå›ç”¨æˆ·æŠ¥å‘Š](https://bbs.deepin.org/forum.php?mod=viewthread&tid=166999) çš„ï¼ˆå®é™…ä¸Šåˆ˜è€å¤§ä¹ŸæŠ¥è¿‡ï¼Œä¸è¿‡è¢«è‡ªåŠ¨å¿½ç•¥äº†ğŸ˜‚ï¼‰ï¼Œè®ºå›ç”¨æˆ·åˆæŠ¥è¿‡æ¥ä»¥åï¼Œå¤§å®¶çœ‹ç”¨æˆ·çš„æŠ¥å‘Šå¤ªè¯¦ç»†äº†ï¼Œæ„ŸåŠ¨å¾—ä¸€å¡Œç³Šæ¶‚ï¼Œé¡¿æ—¶è§£å†³é—®é¢˜çš„åŠ¨åŠ›éƒ½æœ‰äº†ã€‚æˆ‘ä¹ŸæŠ˜è…¾äº†å¤§åŠå¤©ï¼Œä¸è¿‡è„‘è¢‹é‡Œé¢ä¸€ç›´æœ‰ä¸€ä¸ªåŒäº‹çš„å£°éŸ³ï¼šé‚£æ˜¯å­—ä½“æœ‰é—®é¢˜ï¼æˆ‘ä¹ŸæŒºèµåŒçš„ï¼šç›—ç‰ˆçš„å­—ä½“ï¼Œä¸é è°±å¾ˆæ­£å¸¸â€¦â€¦æ‰€ä»¥ï¼Œæˆ‘å°±è€ƒè™‘èƒ½ä¸èƒ½ç»™å­—ä½“åšä¸€äº›åˆ«åå•¥çš„ï¼Œæ¯”å¦‚ `SimSun` å°±å« `å®‹ä½“`â€¦â€¦å½“ç„¶äº†æœ€åå°±æ˜¯ç©äº†ä¸€ä¸‹ `fontconfig` çš„é…ç½®ä»¥åï¼Œé»˜é»˜å°±æ”¾å¼ƒäº†ã€‚

æœ€åç»è¿‡ [@felixonmars](https://github.com/felixonmars) åŒå­¦çš„æ’æŸ¥ï¼Œå‘ç°æ˜¯ä¸Šæ¸¸çš„ä¸€ä¸ª [bug](https://bugs.freedesktop.org/show_bug.cgi?id=105756) ï¼Œè€Œä¸”å·²ç»ä¿®å¤ï¼Œæ‰€ä»¥èµ¶ç´§æ›´äº†ä¸€æ³¢ï¼Œè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚

æœ¬ä»¥ä¸ºçš†å¤§æ¬¢å–œäº†ï¼Œä»Šå¤©åˆæœ‰å®¢æˆ·æŠ¥è¿‡æ¥ bugï¼Œè¯´ Windows ä¸Šå†™å¥½çš„æ–‡æ¡£ï¼Œè°ƒæ•´å¥½çš„å­—ä½“ï¼Œè·‘åˆ°deepinä¸‹å­—ä½“å°±ä¸å¯¹äº†ï¼ŒåºŸäº†è€å¤§çš„åŠ²å„¿æ‰åˆè°ƒå¥½ï¼Œå…¶ä¸­å°±æåˆ°äº†é€‰æ‹©æ–¹æ­£å­—åº“é‡Œé¢çš„å­—ä½“ï¼Œæ˜¾ç¤ºçš„ä¸æ˜¯ä¸­æ–‡å­—ä½“åç§°çš„é—®é¢˜ã€‚

æ€ä¹ˆè¯´å‘¢ï¼Œå¹¸äºæˆ‘è„‘å­ä¸å¥½ï¼Œä¸è®°å¾—ä¹‹å‰å·²ç»è§£å†³è¿‡ä¸­æ–‡å­—ä½“åæ˜¾ç¤ºä¸ºè‹±æ–‡çš„é—®é¢˜ï¼Œè¦ä¸ç„¶å¾—è·Ÿå®¢æˆ·å’Œè€æ¿æ°æ‰¯ä¸€ä¼šå„¿ï¼Œæˆ‘åªè®°å¾—å­—ä½“çš„ä¸­è‹±æ–‡åå­—å¥½åƒæ˜¯æœ‰ç‚¹é—®é¢˜ï¼Œæ‰€ä»¥é»˜é»˜èµ¶ç´§å»çœ‹äº†ä¸€ä¸‹ï¼Œè¿˜çœŸçœŸçš„æœ‰é—®é¢˜ã€‚

å› ä¸º DDE å¹¶æ²¡æœ‰è®¾ç½®è¿‡å¤šçš„ `fontconfig` é…ç½®ï¼Œæ‰€ä»¥æˆ‘ç›¸ä¿¡è¿™ä¸æ˜¯ DDE çš„é—®é¢˜ï¼Œä½†æ˜¯åˆè§‰å¾—å¯¹äºä¸€ä¸ªæ–‡å­—å¤„ç†è½¯ä»¶æ¥è¯´ï¼Œå¦‚æœè¿™ä¹ˆé‡è¦çš„åŠŸèƒ½éƒ½æœ‰ BUGï¼Œæˆ‘çœŸä¸ä¿¡ WPS çš„äººè¿˜èƒ½åå¾—ä½ï¼Œæ‰€ä»¥å°±æƒ³è¯•ä¸€ä¸‹åœ¨ Ubuntu ä¸‹ WPS çš„è¿™ä¸ªè¡Œä¸ºæ˜¯å¦æ­£ç¡®ã€‚åˆšå¥½å¹´å‰ ElementryOS å‘æ–°ç‰ˆçš„æ—¶å€™å°é²œè£…äº†ä¸€ä¸ªåœ¨æµ‹è¯•æœºå™¨ä¸Šï¼Œæ‰€ä»¥å¾ˆå¿«åˆ‡è¿›å»ä¸‹äº†ä¸€ä¸ª WPS å®‰è£…ä¸Šï¼Œä»ä¸€ä¸ªæ­£ç‰ˆçš„ç½‘ç«™ä¸Šä¸‹è½½äº†ä¸€ä¸ªç›—ç‰ˆçš„å®‹ä½“ï¼Œè¯•äº†ä¸€ä¸‹ï¼Œæœç„¶è¸é©¬çš„æ˜¯å¥½çš„â€¦â€¦

ç†æ€§çš„æˆ‘ç”¨äº‹å®è¯æ˜äº†æ„Ÿæ€§çš„æˆ‘æ˜¯é”™è¯¯çš„ï¼Œæ°”æ°›ä¸€åº¦å¾ˆå°´å°¬ã€‚

æ›´è®©äººå°´å°¬çš„æ˜¯ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“è¿™æ˜¯æ€ä¹ˆå›äº‹ã€‚ä½†æ˜¯ï¼Œæ— å·§ä¸æˆä¹¦ï¼Œå°±åœ¨è¿™ç§å°´å°¬æ°›å›´çš„ç¬¼ç½©ä¸‹ï¼Œæˆ‘é¬¼ä½¿ç¥å·®åœ°åœ¨ ElementryOS ï¼ˆå¤ªé•¿äº†ï¼Œä¸‹é¢ç®€ç§° EOS ï¼‰ä¸Šè¿è¡Œäº† `fc-match å®‹ä½“` è¿™ä¸ªå‘½ä»¤ï¼Œè€Œä¸”å¾ˆç¥å¥‡çš„å‘ç°è¾“å‡ºçš„ `simsun.ttf: "å®‹ä½“" "Regular"` è·Ÿ deepin ä¸‹åŒæ ·å‘½ä»¤è¾“å‡ºçš„ `simsun.ttf: "SimSun" "Regular"` ä¸å¤ªä¸€æ ·ï¼Œè¿™å¯æŠŠæˆ‘ä¹åäº†â€”â€”è¦çŸ¥é“ä¸€ä¸ªç¨å¾®å¤æ‚ç‚¹çš„å›¾å½¢è½¯ä»¶ï¼Œæ‰“å¼€ `fontconfig` çš„è°ƒè¯•ä»¥åï¼Œè¾“å‡ºå°±æ˜¯å¾ˆå¯æ€•çš„ï¼Œæ›´åˆ«è¯´ WPSï¼åˆ«é—®æˆ‘æ˜¯æ€ä¹ˆçŸ¥é“çš„ï¼Œå›å¿†èµ·æ¥éƒ½æ˜¯æ³ªã€‚ä½†æ˜¯ç°åœ¨ä½¿ç”¨ `fc-match` å°±èƒ½é‡ç°çš„é—®é¢˜ï¼ˆæˆ‘æ‰“å¿ƒåº•è®¤ä¸ºè¿™ä¿©æ˜¯åŒä¸€ä¸ªé—®é¢˜ï¼‰ï¼Œè°ƒè¯•èµ·æ¥å°±æ¯”è¾ƒç®€å•äº†ã€‚

`fontconfig` æœ¬èº«ä¸ºäº†æ–¹ä¾¿ç¨‹åºè°ƒè¯•ï¼Œå†…å»ºäº†ä¸€äº›è°ƒè¯•é¡¹ï¼Œå¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡ `FC_DEBUG` æ§åˆ¶ï¼š

```
Name         Value    Meaning
  ---------------------------------------------------------
  MATCH            1    Brief information about font matching
  MATCHV           2    Extensive font matching information
  EDIT             4    Monitor match/test/edit execution
  FONTSET          8    Track loading of font information at startup
  CACHE           16    Watch cache files being written
  CACHEV          32    Extensive cache file writing information
  PARSE           64    (no longer in use)
  SCAN           128    Watch font files being scanned to build caches
  SCANV          256    Verbose font file scanning information
  MEMORY         512    Monitor fontconfig memory usage
  CONFIG        1024    Monitor which config files are loaded
  LANGSET       2048    Dump char sets used to construct lang values
  MATCH2        4096    Display font-matching transformation in patterns
```

æˆ‘ä»¬åªéœ€è¦æœ€ç®€ç•¥çš„åŒ¹é…ä¿¡æ¯å°±å¯ä»¥äº†ï¼Œæ‰€ä»¥ï¼š

```bash
$ FC_DEBUG=1 fc-match å®‹ä½“
FC_DEBUG=1
Match Pattern has 25 elts (size 32)
	family: "å®‹ä½“"(s) "Noto Sans CJK SC"(s) "Noto Sans"(s)
	familylang: "en"(s) "en-us"(w)
	stylelang: "en"(s) "en-us"(w)
	fullnamelang: "en"(s) "en-us"(w)
	slant: 0(i)(s)
	weight: 80(i)(s)
	width: 100(i)(s)
	size: 12(f)(s)
	pixelsize: 12.5(f)(s)
	hintstyle: 1(i)(w)
	hinting: True(s)
	verticallayout: False(s)
	autohint: False(s)
	globaladvance: True(s)
	dpi: 75(f)(s)
	scale: 1(f)(s)
	lang: "zh-CN"(w)
	fontversion: 2147483647(i)(s)
	embeddedbitmap: True(s)
	decorative: False(s)
	lcdfilter: 1(i)(w)
	namelang: "en"(w)
	prgname: "fc-match"(s)
	symbol: False(s)
	variable: False(s)

Best score 0 0 0 0 0 0 0 0 0 0 1e+99 0 0 0 0 0 0 0 0 0 0 0 0 0 2.14735e+12
Pattern has 25 elts (size 25)
	family: "SimSun"(w) "å®‹ä½“"(w)
	familylang: "en"(w) "zh-cn"(w)
	style: "Regular"(w)
	stylelang: "en"(w)
	fullname: "SimSun"(w) "å®‹ä½“"(w)
	fullnamelang: "en"(w) "zh-cn"(w)
	slant: 0(i)(w)
	weight: 80(f)(w)
	width: 100(f)(w)
	spacing: 90(i)(w)
	foundry: "ZYEC"(w)
	file: "/home/hualet/.fonts/simsun.ttf"(w)
	index: 0(i)(w)
	outline: True(w)
	scalable: True(w)
	charset: 
	0000: 00000000 ffffffff ffffffff ffffffff 00000000 ffffffff ffffffff ffffffff
	0001: 08080002 00000800 000c2110 01000803 00040000 00000000 15554000 00000000
	0002: 00000000 00000000 00020000 00000002 00000000 00000000 12000ec0 00000000
	0003: 00000000 00000000 00000000 00000000 fffe0000 fffe03fb 000003fb 00000000
	0004: ffff0002 ffffffff 0002ffff 00000000 00000000 00000000 00000000 00000000
	0020: 77790000 0e2d0067 00000000 00000000 00000000 00001000 00000000 00000000
	0021: 00400228 00000006 00000000 03ff0fff 03cf0000 00000000 00000000 00000000
	0022: e4228100 20f04fa9 00041100 0000c0f3 02200000 80000020 00000000 00000000
	0023: 00040000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
	0024: 00000000 00000000 00000000 fff003ff 0fffffff 00000000 00000000 00000000
	0025: ffffffff ffffffff ffff0fff 000fffff 0038fffe 300c0003 0000c8c0 0000003c
	0026: 00000260 00000000 00000005 00000000 00000000 00000000 00000000 00000000
	0030: 60ffffef 000003fe fffffffe ffffffff 780fffff fffffffe ffffffff 707fffff
	0031: ffffffe0 000003ff 00000000 00000000 00000000 00000000 00000000 00000000
	0032: 00000000 000203ff 00000000 00000000 00000000 00000008 00000000 00000000
	0033: 00000000 00000000 00000000 00000000 7000c000 00000002 00264010 00000000
	004e: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	004f: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0050: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0051: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0052: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0053: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0054: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0055: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0056: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0057: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0058: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0059: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	005a: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	005b: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	005c: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	005d: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	005e: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	005f: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0060: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0061: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0062: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0063: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0064: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0065: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0066: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0067: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0068: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0069: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	006a: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	006b: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	006c: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	006d: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	006e: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	006f: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0070: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0071: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0072: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0073: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0074: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0075: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0076: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0077: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0078: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0079: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	007a: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	007b: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	007c: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	007d: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	007e: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	007f: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0080: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0081: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0082: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0083: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0084: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0085: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0086: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0087: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0088: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0089: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	008a: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	008b: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	008c: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	008d: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	008e: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	008f: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0090: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0091: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0092: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0093: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0094: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0095: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0096: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0097: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0098: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	0099: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	009a: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	009b: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	009c: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	009d: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	009e: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
	009f: ffffffff ffffffff ffffffff ffffffff ffffffff 0000003f 00000000 00000000
	00e7: 00000000 00000000 00000000 00000000 00000000 00000000 00000180 000fff80
	00e8: ffe00000 ffffffff ffffffff 0000001f 00000000 00000000 00000000 00000000
	00f9: 00000000 00001000 00000000 02000000 00200000 00000000 00000000 00020080
	00fa: 811af000 0000039b 00000000 00000000 00000000 00000000 00000000 00000000
	00fe: 00000000 fffb0000 fef7fe1f 00000f7f 00000000 00000000 00000000 00000000
	00ff: fffffffe ffffffff 7fffffff 00000000 00000000 00000000 00000000 0000003f
(w)
	lang: aa|ay|bg|bi|br|ch|co|da|de|en|es|eu|fj|fo|fr|fur|fy|gd|gl|gv|ho|ia|id|ie|io|is|it|kum|lb|mg|nb|nds|nl|nn|no|nr|nso|oc|om|os|pt|rm|ru|sel|sma|smj|so|sq|ss|st|sv|sw|tl|tn|ts|uz|vo|wa|xh|yap|zh-cn|zh-sg|zu|an|fil|ht|jv|kj|kwm|li|ms|ng|pap-an|pap-aw|rn|rw|sc|sg|sn|su|za(w)
	fontversion: 131072(i)(w)
	capability: "otlayout:hani"(w)
	fontformat: "TrueType"(w)
	decorative: False(w)
	postscriptname: "SimSun"(w)
	color: False(w)
	symbol: False(w)
	variable: False(w)

simsun.ttf: "SimSun" "Regular"

```

å› ä¸ºä»¥å‰è°ƒ `fontconfig` çš„ç»éªŒï¼Œæˆ‘æ¨¡æ¨¡ç³Šç³ŠçŸ¥é“é‚£ä¸ª `familylang` æ˜¯æ§åˆ¶ `family` ä¹Ÿå°±æ˜¯å­—ä½“åæ˜¾ç¤ºçš„è¯­è¨€çš„ï¼Œæ‰€ä»¥çœ‹åˆ° 

```bash
familylang: "en"(s) "en-us"(w)
```

è¿™è¡Œä»¥åï¼Œå¤§è‡´èƒ½ç¡®å®šåº”è¯¥æ˜¯ç³»ç»ŸæŸä¸ªé…ç½®å‡ºäº†é—®é¢˜è®© `fontconfig` è¯¯ä»¥ä¸ºè¯­è¨€ç¯å¢ƒæ˜¯è‹±æ–‡ã€‚çœ‹äº†ä¸€ä¸‹ç¯å¢ƒå˜é‡ï¼Œæ²¡å‘ç°å“ªä¸ªæ˜¯è®¾ç½®è‹±æ–‡çš„ï¼Œæ‰€ä»¥åªèƒ½å»çœ‹ä»£ç äº†ã€‚

ä¸‹äº† `fontconfig` çš„æºç ï¼Œæœäº†ä¸€ä¸‹å…³é”®å­— `familylang` ï¼ŒçŒœæµ‹è¿™ä¸ªå±æ€§åº”è¯¥æ˜¯é€šè¿‡æ“çºµ `FC_FAMILYLANG_OBJECT` ï¼Œå†æ¬¡æœç´¢ï¼š

```
 $ rg -i FC_FAMILYLANG_OBJECT
src/fcmatch.c
380:	case FC_FAMILYLANG_OBJECT:
551:	if (fe->object == FC_FAMILYLANG_OBJECT ||
565:	    FC_ASSERT_STATIC ((FC_FAMILY_OBJECT + 1) == FC_FAMILYLANG_OBJECT);
695:	    pe->object != FC_FAMILYLANG_OBJECT &&

src/fclist.c
430:		familyidx = FcGetDefaultObjectLangIndex (font, FC_FAMILYLANG_OBJECT, lang);

src/fcfreetype.c
1671:	    while (FcPatternObjectGetString (pat, FC_FAMILYLANG_OBJECT, n, &familylang) == FcResultMatch)

src/fcdefault.c
316:    if (!FcPatternFindObjectIter (pattern, &iter, FC_FAMILYLANG_OBJECT))
318:	FcPatternObjectAdd (pattern, FC_FAMILYLANG_OBJECT, namelang, FcTrue);
319:	FcPatternObjectAddWithBinding (pattern, FC_FAMILYLANG_OBJECT, v2, FcValueBindingWeak, FcTrue);

```

å‘ç°å…¶ä¸­åªæœ‰ `fcdefault.c` é‡Œé¢æœ‰æ‰§è¡Œ `FcPatternObjectAdd` è¿™ä¸ªæ“ä½œåƒæ˜¯åœ¨ä¿®æ”¹è¿™ä¸ªå±æ€§ï¼Œå…¶ä»–åœ°æ–¹æ˜æ˜¾éƒ½åªæ˜¯è¯»å–ï¼Œåˆšå¥½ `fc-match/fc-match.c` é‡Œé¢ä¹Ÿæœ‰è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥ä»”ç»†çœ‹äº†ä¸€ä¸‹è¿™ä¸ªå‡½æ•°ï¼Œä»é€»è¾‘ä¸Šçœ‹æ„æ€æ˜¯ `familylang` å¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œå°±ä¼šä» `namelang` å±æ€§ç»§æ‰¿ï¼Œç„¶åæˆ‘å¿½ç„¶å‘ç° `fc-match` çš„å¸®åŠ©é‡Œé¢å†™å¾—ä½ç½®å‚æ•°æ¦‚å¿µä¸Šå« `pattern` ï¼Œéš¾é“å°±å¯¹åº” `FcPattern`ï¼Œé‚£å®ƒåº”è¯¥ä¹Ÿå¯ä»¥æŒ‡å®š `familylang` å’¯ï¼Ÿç½‘ä¸Šæœå¯»äº†ä¸€ç•ªï¼Œå‘ç°å¯ä»¥ `fc-match å®‹ä½“:familylang=zh-cn`ï¼Œæœç„¶è¾“å‡ºæ­£å¸¸çš„ä¸­æ–‡åã€‚è¿™ç®—æ˜¯ä¸€ä¸ªå°æ’æ›²å§ã€‚

æ¥ç€ `namelang` å±æ€§è¯´ï¼Œè¿™ä¸ªå±æ€§æ˜¯ä»ä¸€ä¸ªå« `FcGetDefaultLang` çš„å‡½æ•°å¤„è·å–ï¼Œæˆ‘å¿ƒæƒ³æ€»ç®—æ˜¯è¦åˆ°å¤´äº†ï¼Œç„¶è€Œå‘ç°ä»å‡½æ•°çš„å®ç°æ¥çœ‹ï¼Œè¿™ä¸ªå‡½æ•°ä¼šä» `FC_LANG`ã€`LC_ALL`ã€`LC_CTYPE`å’Œ`LANG`è¿™äº›ç¯å¢ƒå˜é‡é‡Œé¢æŒ¨ä¸ªè¯»å–é»˜è®¤çš„è¯­è¨€ï¼ˆåæ¥å‘ç°ç›´æ¥ `man FcGetDefaultlangs` å°±å¯ä»¥çœ‹åˆ°ï¼‰ï¼Œçœ‹èµ·æ¥æ²¡æ¯›ç—…å‘€ã€‚

å†™äº†ä¸ªæµ‹è¯•ç¨‹åºï¼š

```c
#include <stdlib.h>
#include <stdio.h>

#include <fontconfig/fontconfig.h>

int main(int argc, char const *argv[])
{
    FcStrSet *langs = NULL;

    langs = FcGetDefaultLangs();
    if (langs)
    {
        FcChar8 *lang = NULL;
        FcStrList *lang_list = NULL;

        lang_list = FcStrListCreate(langs);
        FcStrListFirst(lang_list);

        while(lang = FcStrListNext(lang_list)) {
            printf("%s", lang);
        }
    }

    return 0;
}
```

ç¼–è¯‘æ‰§è¡Œï¼Œè¾“å‡º `zh-CN` ï¼Œ666

ä¸­é—´å°è¯•äº†ä½¿ç”¨ `gdb` åœ¨ `fc-match.c`ä¸­è°ƒç”¨ `FcDefaultSubstitute` çš„éƒ¨åˆ†åŠ æ–­ç‚¹ï¼Œä½†æ˜¯æ­»æ´»æ— æ³•è·³å…¥å‡½æ•°ä½“é‡Œé¢ï¼Œç›´æ¥åœ¨å‡½æ•°é‡Œé¢å“åº”çš„è¡Œæ•°å¤„æ–­ç‚¹ï¼Œç›´æ¥æ— æ•ˆâ€¦â€¦æ’é¬¼äº†

æ²¡åŠæ³•äº†ï¼Œåªèƒ½æ”¹ä»£ç äº†ï¼Œæ‰¾äº†æ‰¾ä»£ç é‡Œé¢çš„ log æ¨¡å—å« `fcdbg.c` ï¼Œæˆ‘æœ¬æ¥è¿˜è¯´ä» `FcPattern`  é‡Œé¢è¯»å–å±æ€§æœ‰ç‚¹éº»çƒ¦ï¼Œåˆä¸ç†Ÿæ‚‰ä»£ç ï¼Œä½†æ˜¯æ„å¤–åœ°æ‰¾åˆ°ä¸€ä¸ª `FcPatternPrint` ï¼Œè¿™ä¸‹è¿ç»§ç»­ç ”ç©¶ä¸‹å»çš„åŠ¨åŠ›éƒ½æ²¡æœ‰äº†ï¼Œèµ¶ç´§åŠ ä»£ç æ‰“å°ï¼Œåˆ†åˆ«åœ¨ `FcConfigSubstitute` å’Œ `FcDefaultSubstitute` å‰ååŠ äº†æ‰“å°çœ‹å¯¹ `pat` çš„ä»£ç ï¼š

```
	FcPatternPrint(pat);
    FcConfigSubstitute (0, pat, FcMatchPattern);
	FcPatternPrint(pat);
    FcDefaultSubstitute (pat);
	FcPatternPrint(pat);
```

è¾“å‡ºï¼š

```bash
$ ./fc-match å®‹ä½“
Pattern has 1 elts (size 16)
	family: "å®‹ä½“"(s)

Pattern has 6 elts (size 16)
	family: "å®‹ä½“"(s) "Noto Sans CJK SC"(s) "Noto Sans"(s)
	hintstyle: 1(i)(w)
	lang: "zh-CN"(w)
	lcdfilter: 1(i)(w)
	namelang: "en"(w)
	prgname: "fc-match"(s)

Pattern has 25 elts (size 32)
	family: "å®‹ä½“"(s) "Noto Sans CJK SC"(s) "Noto Sans"(s)
	familylang: "en"(s) "en-us"(w)
	stylelang: "en"(s) "en-us"(w)
	fullnamelang: "en"(s) "en-us"(w)
	slant: 0(i)(s)
	weight: 80(i)(s)
	width: 100(i)(s)
	size: 12(f)(s)
	pixelsize: 12.5(f)(s)
	hintstyle: 1(i)(w)
	hinting: True(s)
	verticallayout: False(s)
	autohint: False(s)
	globaladvance: True(s)
	dpi: 75(f)(s)
	scale: 1(f)(s)
	lang: "zh-CN"(w)
	fontversion: 2147483647(i)(s)
	embeddedbitmap: True(s)
	decorative: False(s)
	lcdfilter: 1(i)(w)
	namelang: "en"(w)
	prgname: "fc-match"(s)
	symbol: False(s)
	variable: False(s)

simsun.ttf: "SimSun" "Regular"
```

å¯ä»¥ç¡®è®¤æ˜¯ `FcConfigSubstitute` å‡½æ•°é‡Œé¢ç»™ `pat` è®¾ç½®äº† `en` çš„ `namelang`ï¼Œé‚£ä¹‹ååœ¨ ``FcDefaultSubstitute`` ä¸­ `familylang`  å°±ä» `namelang` ç»§æ‰¿äº† `en` ï¼ŒåˆåŠ ä¸Šäº† `en-us` ï¼Œå˜æˆäº†æˆ‘ä»¬çœ‹åˆ°çš„ `"en"ï¼Œ"en-us"` ã€‚çœ‹å‡½æ•°åï¼Œ ``FcConfigSubstitute`` åº”è¯¥å°±æ˜¯è¯»å–äº†é…ç½®æ–‡ä»¶ï¼Œç„¶ååšäº†ä»€ä¹ˆä¿®æ”¹ï¼Œè‡³äºæ€ä¹ˆæ”¹çš„æˆ‘ä¹Ÿä¸çŸ¥é“ã€‚

è¿™æ—¶å€™æˆ‘å·æ‡’ç—‡çŠ¯äº†ï¼Œæ²¡æœ‰å»çœ‹ä»£ç äº†ï¼ˆçœ‹ç€ç•¥å¤æ‚ï¼‰ï¼Œæˆ‘å‘ç°æ–°ç‰ˆ `fontconfig` å¤šäº†ä¸€ä¸ªå·¥å…·å« `fc-conflist` èƒ½åˆ—å‡ºæ¥ `fontconfig` åŠ è½½çš„æ‰€æœ‰é…ç½®æ–‡ä»¶åˆ—è¡¨ï¼Œé€šè¿‡è¿™ä¸ªå‘½ä»¤æˆ‘å‘ç°ç³»ç»Ÿé‡Œé¢çš„é…ç½®æ–‡ä»¶ä¸»è¦æ”¾åœ¨ `/etc/fonts` å’Œ `/usr/share/fontconfig` ï¼Œç„¶åå°±ç”¨ `rg` å»é‡Œé¢æœå…³é”®å­— `lang` äº†ï¼Œæ’é™¤å…¶ä¸­ `<test>` çš„è¡Œï¼Œè¿˜çœŸå‘ç°ä¸€ä¸ªå« `/usr/share/conf.avail/15-assign-lang-en.conf` çš„æ–‡ä»¶é‡Œé¢æœ‰ `edit` `namelang` è¿™ä¸ªå±æ€§ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘éƒ½ä¸çŸ¥é“è¿˜æœ‰ `edit` è¿™ç§æ“ä½œâ€¦â€¦æˆ‘ä¹Ÿæ›´ä¸ä¿¡è¿™ä¸ªé—®é¢˜ä¼šå‡ºåœ¨ `fontconfig` çš„é…ç½®ä¸Šã€‚

```bash
$ dpkg -S conf.avail/15-assign-lang-en.conf
deepin-default-settings: /usr/share/fontconfig/conf.avail/15-assign-lang-en.conf
```

äº‹å®è¯æ˜ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶è¿˜çœŸæ˜¯ deepin æä¾›çš„â€¦â€¦

æœ¬æ¥æƒ³ææ¸…æ¥šä¹‹å‰ä¸ºä»€ä¹ˆè¦åšè¿™ä¸ªçš„ï¼Œä½†æ˜¯æäº¤ä¿¡æ¯å¤ªç®€å•äº†ï¼Œæ²¡æœ‰æä¾›ç›¸å…³çº¿ç´¢ï¼ŒçŒœæµ‹åº”è¯¥æ˜¯ä»¥å‰æœ‰äº›å­—ä½“åç§°ä¼šä¹±ç â€”â€”å­—ä½“åç§°éœ€è¦ç‰¹æ®Šå­—ä½“çš„æ”¯æŒï¼Œç„¶è€Œç³»ç»Ÿï¼ˆç»ˆç«¯ï¼‰çš„å­—ä½“ä¸æ”¯æŒè¿™ç§å­—ä½“çš„å­—ä½“åï¼Œä¸ºäº†è§£å†³ä¹±ç ï¼Œé»˜è®¤ä½¿ç”¨è‹±æ–‡è¾“å‡ºå­—ä½“åç§° ğŸ˜… 

ä¸è¿‡æœ‰äº† Noto è¿™ç§é—®é¢˜åº”è¯¥å°±å¾ˆå°‘äº†ï¼Œæ‰€ä»¥ç‹ å¿ƒåˆ æ‰äº†è¿™ä¸ªé…ç½®ï¼š[æäº¤](https://github.com/linuxdeepin/default-settings/commit/34ce7928e70f082b02a7da7e60a9ddaaf7a036f4)ã€‚



ç»“åˆè¿™ä¸¤ä¸ªé—®é¢˜ï¼ŒçŒœæµ‹ WPS å­—ä½“è®¾ç½®åˆ†ä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯ä»ç³»ç»Ÿè·å–å­—ä½“åˆ—è¡¨ï¼Œè¿™ä¸ªéƒ¨åˆ†æ˜¯ä» Qt æ‹¿çš„ï¼Œç”¨çš„ Qt æä¾›çš„å­—ä½“åï¼ˆä¸­æ–‡ï¼‰ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯ä»è¿™ä¸ªå­—ä½“åæ‹¿åˆ°ç³»ç»Ÿä¸­åŒ¹é…åº¦æœ€é«˜çš„å­—ä½“ï¼Œåº”è¯¥æ˜¯é€šè¿‡ `libfontconfig` ç›´æ¥åšå¾—ï¼ˆdeepinä¸‹è‹±æ–‡ï¼‰ï¼Œç„¶åå†æŠŠè¿™ä¸ªå­—ä½“è®¾ç½®ç»™å®é™…çš„æ–‡æ¡£ï¼Œå·¥å…·æ ä¸­æ˜¾ç¤ºçš„ä¹Ÿå°±æ˜¯è¿™ä¸ªåå­—ã€‚æ€»ä¹‹ï¼Œäººå®¶åˆä¸å¼€æºï¼ŒççŒœä¸€ä¸‹å›¾ä¸ªå¼€å¿ƒå’¯ã€‚