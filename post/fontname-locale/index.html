<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <title>
  WPS中的字体名 · johndoe
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="John Doe">
<meta name="description" content="今天又被 fontconfig 坑到了……仔细想想，半年到一年前我还对 fontconfig 狗屁不通呢，而现在我已经被 fontconfit 坑了有几次了，这印证了一个真理：“只要你足够迟钝，世界就是美好的，一旦你有了某种能力，麻烦就会找到你”——这只是个玩笑，事实上不管你有没有能力，现实都不会让你好过 😈
在这些坑里面，有两个是跟今天主题相关的，也就是关于WPS中字体名称的两个问题：
WPS 字体列表中中文字体在中文环境下不显示中文名（比如系统里面有宋体，列表里面显示 SimSun）； WPS 设置段落字体（中文字体）后，工具栏显示的字体为英文名（比如你设置一段文字是宋体，但是标题栏显示的仍然是SimSun） 这两个问题有点像，但是却不是同一个问题（也不只是WPS有问题，而是WPS对字体的需求比较多）：
第一个问题原先是 论坛用户报告 的（实际上刘老大也报过，不过被自动忽略了😂），论坛用户又报过来以后，大家看用户的报告太详细了，感动得一塌糊涂，顿时解决问题的动力都有了。我也折腾了大半天，不过脑袋里面一直有一个同事的声音：那是字体有问题！我也挺赞同的：盗版的字体，不靠谱很正常……所以，我就考虑能不能给字体做一些别名啥的，比如 SimSun 就叫 宋体……当然了最后就是玩了一下 fontconfig 的配置以后，默默就放弃了。
最后经过 @felixonmars 同学的排查，发现是上游的一个 bug ，而且已经修复，所以赶紧更了一波，解决了这个问题。
本以为皆大欢喜了，今天又有客户报过来 bug，说 Windows 上写好的文档，调整好的字体，跑到deepin下字体就不对了，废了老大的劲儿才又调好，其中就提到了选择方正字库里面的字体，显示的不是中文字体名称的问题。
怎么说呢，幸亏我脑子不好，不记得之前已经解决过中文字体名显示为英文的问题，要不然得跟客户和老板掰扯一会儿，我只记得字体的中英文名字好像是有点问题，所以默默赶紧去看了一下，还真真的有问题。
因为 DDE 并没有设置过多的 fontconfig 配置，所以我相信这不是 DDE 的问题，但是又觉得对于一个文字处理软件来说，如果这么重要的功能都有 BUG，我真不信 WPS 的人还能坐得住，所以就想试一下在 Ubuntu 下 WPS 的这个行为是否正确。刚好年前 ElementryOS 发新版的时候尝鲜装了一个在测试机器上，所以很快切进去下了一个 WPS 安装上，从一个正版的网站上下载了一个盗版的宋体，试了一下，果然踏马的是好的……
理性的我用事实证明了感性的我是错误的，气氛一度很尴尬。
更让人尴尬的是，我也不知道这是怎么回事。但是，无巧不成书，就在这种尴尬氛围的笼罩下，我鬼使神差地在 ElementryOS （太长了，下面简称 EOS ）上运行了 fc-match 宋体 这个命令，而且很神奇的发现输出的 simsun.ttf: &quot;宋体&quot; &quot;Regular&quot; 跟 deepin 下同样命令输出的 simsun.ttf: &quot;SimSun&quot; &quot;Regular&quot; 不太一样，这可把我乐坏了——要知道一个稍微复杂点的图形软件，打开 fontconfig 的调试以后，输出就是很可怕的，更别说 WPS！别问我是怎么知道的，回忆起来都是泪。但是现在使用 fc-match 就能重现的问题（我打心底认为这俩是同一个问题），调试起来就比较简单了。">
<meta name="keywords" content="blog,developer,personal">


  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="WPS中的字体名">
  <meta name="twitter:description" content="今天又被 fontconfig 坑到了……仔细想想，半年到一年前我还对 fontconfig 狗屁不通呢，而现在我已经被 fontconfit 坑了有几次了，这印证了一个真理：“只要你足够迟钝，世界就是美好的，一旦你有了某种能力，麻烦就会找到你”——这只是个玩笑，事实上不管你有没有能力，现实都不会让你好过 😈
在这些坑里面，有两个是跟今天主题相关的，也就是关于WPS中字体名称的两个问题：
WPS 字体列表中中文字体在中文环境下不显示中文名（比如系统里面有宋体，列表里面显示 SimSun）； WPS 设置段落字体（中文字体）后，工具栏显示的字体为英文名（比如你设置一段文字是宋体，但是标题栏显示的仍然是SimSun） 这两个问题有点像，但是却不是同一个问题（也不只是WPS有问题，而是WPS对字体的需求比较多）：
第一个问题原先是 论坛用户报告 的（实际上刘老大也报过，不过被自动忽略了😂），论坛用户又报过来以后，大家看用户的报告太详细了，感动得一塌糊涂，顿时解决问题的动力都有了。我也折腾了大半天，不过脑袋里面一直有一个同事的声音：那是字体有问题！我也挺赞同的：盗版的字体，不靠谱很正常……所以，我就考虑能不能给字体做一些别名啥的，比如 SimSun 就叫 宋体……当然了最后就是玩了一下 fontconfig 的配置以后，默默就放弃了。
最后经过 @felixonmars 同学的排查，发现是上游的一个 bug ，而且已经修复，所以赶紧更了一波，解决了这个问题。
本以为皆大欢喜了，今天又有客户报过来 bug，说 Windows 上写好的文档，调整好的字体，跑到deepin下字体就不对了，废了老大的劲儿才又调好，其中就提到了选择方正字库里面的字体，显示的不是中文字体名称的问题。
怎么说呢，幸亏我脑子不好，不记得之前已经解决过中文字体名显示为英文的问题，要不然得跟客户和老板掰扯一会儿，我只记得字体的中英文名字好像是有点问题，所以默默赶紧去看了一下，还真真的有问题。
因为 DDE 并没有设置过多的 fontconfig 配置，所以我相信这不是 DDE 的问题，但是又觉得对于一个文字处理软件来说，如果这么重要的功能都有 BUG，我真不信 WPS 的人还能坐得住，所以就想试一下在 Ubuntu 下 WPS 的这个行为是否正确。刚好年前 ElementryOS 发新版的时候尝鲜装了一个在测试机器上，所以很快切进去下了一个 WPS 安装上，从一个正版的网站上下载了一个盗版的宋体，试了一下，果然踏马的是好的……
理性的我用事实证明了感性的我是错误的，气氛一度很尴尬。
更让人尴尬的是，我也不知道这是怎么回事。但是，无巧不成书，就在这种尴尬氛围的笼罩下，我鬼使神差地在 ElementryOS （太长了，下面简称 EOS ）上运行了 fc-match 宋体 这个命令，而且很神奇的发现输出的 simsun.ttf: &#34;宋体&#34; &#34;Regular&#34; 跟 deepin 下同样命令输出的 simsun.ttf: &#34;SimSun&#34; &#34;Regular&#34; 不太一样，这可把我乐坏了——要知道一个稍微复杂点的图形软件，打开 fontconfig 的调试以后，输出就是很可怕的，更别说 WPS！别问我是怎么知道的，回忆起来都是泪。但是现在使用 fc-match 就能重现的问题（我打心底认为这俩是同一个问题），调试起来就比较简单了。">

<meta property="og:url" content="http://localhost:1313/post/fontname-locale/">
  <meta property="og:site_name" content="johndoe">
  <meta property="og:title" content="WPS中的字体名">
  <meta property="og:description" content="今天又被 fontconfig 坑到了……仔细想想，半年到一年前我还对 fontconfig 狗屁不通呢，而现在我已经被 fontconfit 坑了有几次了，这印证了一个真理：“只要你足够迟钝，世界就是美好的，一旦你有了某种能力，麻烦就会找到你”——这只是个玩笑，事实上不管你有没有能力，现实都不会让你好过 😈
在这些坑里面，有两个是跟今天主题相关的，也就是关于WPS中字体名称的两个问题：
WPS 字体列表中中文字体在中文环境下不显示中文名（比如系统里面有宋体，列表里面显示 SimSun）； WPS 设置段落字体（中文字体）后，工具栏显示的字体为英文名（比如你设置一段文字是宋体，但是标题栏显示的仍然是SimSun） 这两个问题有点像，但是却不是同一个问题（也不只是WPS有问题，而是WPS对字体的需求比较多）：
第一个问题原先是 论坛用户报告 的（实际上刘老大也报过，不过被自动忽略了😂），论坛用户又报过来以后，大家看用户的报告太详细了，感动得一塌糊涂，顿时解决问题的动力都有了。我也折腾了大半天，不过脑袋里面一直有一个同事的声音：那是字体有问题！我也挺赞同的：盗版的字体，不靠谱很正常……所以，我就考虑能不能给字体做一些别名啥的，比如 SimSun 就叫 宋体……当然了最后就是玩了一下 fontconfig 的配置以后，默默就放弃了。
最后经过 @felixonmars 同学的排查，发现是上游的一个 bug ，而且已经修复，所以赶紧更了一波，解决了这个问题。
本以为皆大欢喜了，今天又有客户报过来 bug，说 Windows 上写好的文档，调整好的字体，跑到deepin下字体就不对了，废了老大的劲儿才又调好，其中就提到了选择方正字库里面的字体，显示的不是中文字体名称的问题。
怎么说呢，幸亏我脑子不好，不记得之前已经解决过中文字体名显示为英文的问题，要不然得跟客户和老板掰扯一会儿，我只记得字体的中英文名字好像是有点问题，所以默默赶紧去看了一下，还真真的有问题。
因为 DDE 并没有设置过多的 fontconfig 配置，所以我相信这不是 DDE 的问题，但是又觉得对于一个文字处理软件来说，如果这么重要的功能都有 BUG，我真不信 WPS 的人还能坐得住，所以就想试一下在 Ubuntu 下 WPS 的这个行为是否正确。刚好年前 ElementryOS 发新版的时候尝鲜装了一个在测试机器上，所以很快切进去下了一个 WPS 安装上，从一个正版的网站上下载了一个盗版的宋体，试了一下，果然踏马的是好的……
理性的我用事实证明了感性的我是错误的，气氛一度很尴尬。
更让人尴尬的是，我也不知道这是怎么回事。但是，无巧不成书，就在这种尴尬氛围的笼罩下，我鬼使神差地在 ElementryOS （太长了，下面简称 EOS ）上运行了 fc-match 宋体 这个命令，而且很神奇的发现输出的 simsun.ttf: &#34;宋体&#34; &#34;Regular&#34; 跟 deepin 下同样命令输出的 simsun.ttf: &#34;SimSun&#34; &#34;Regular&#34; 不太一样，这可把我乐坏了——要知道一个稍微复杂点的图形软件，打开 fontconfig 的调试以后，输出就是很可怕的，更别说 WPS！别问我是怎么知道的，回忆起来都是泪。但是现在使用 fc-match 就能重现的问题（我打心底认为这俩是同一个问题），调试起来就比较简单了。">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2019-01-14T18:31:08+08:00">
    <meta property="article:modified_time" content="2019-01-14T18:31:08+08:00">




<link rel="canonical" href="http://localhost:1313/post/fontname-locale/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.css" media="screen">






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.css" media="screen">
  



 




<link rel="icon" type="image/svg+xml" href="/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="http://localhost:1313/">
      johndoe
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/about/">About</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/posts/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/projects/">Projects</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/contact/">Contact me</a>
            </li>
          
        
        
          
          
          
            
          
            
              
                <li class="navigation-item menu-separator">
                  <span>|</span>
                </li>
                
              
              <li class="navigation-item">
                <a href="/pt-br/">🇧🇷</a>
              </li>
            
          
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container page">
  <article>
    <header>
      <h1 class="title">
        <a class="title-link" href="http://localhost:1313/post/fontname-locale/">
          WPS中的字体名
        </a>
      </h1>
    </header>

    <p>今天又被  <code>fontconfig</code> 坑到了……仔细想想，半年到一年前我还对 <code>fontconfig</code>  狗屁不通呢，而现在我已经被 <code>fontconfit</code> 坑了有几次了，这印证了一个真理：“只要你足够迟钝，世界就是美好的，一旦你有了某种能力，麻烦就会找到你”——这只是个玩笑，事实上不管你有没有能力，现实都不会让你好过 😈</p>
<p>在这些坑里面，有两个是跟今天主题相关的，也就是关于WPS中字体名称的两个问题：</p>
<ul>
<li>WPS 字体列表中中文字体在中文环境下不显示中文名（比如系统里面有宋体，列表里面显示 <code>SimSun</code>）；</li>
<li>WPS 设置段落字体（中文字体）后，工具栏显示的字体为英文名（比如你设置一段文字是宋体，但是标题栏显示的仍然是<code>SimSun</code>）</li>
</ul>
<p>这两个问题有点像，但是却不是同一个问题（也不只是WPS有问题，而是WPS对字体的需求比较多）：</p>
<p>第一个问题原先是 <a href="https://bbs.deepin.org/forum.php?mod=viewthread&amp;tid=166999"  class="external-link" target="_blank" rel="noopener">论坛用户报告</a> 的（实际上刘老大也报过，不过被自动忽略了😂），论坛用户又报过来以后，大家看用户的报告太详细了，感动得一塌糊涂，顿时解决问题的动力都有了。我也折腾了大半天，不过脑袋里面一直有一个同事的声音：那是字体有问题！我也挺赞同的：盗版的字体，不靠谱很正常……所以，我就考虑能不能给字体做一些别名啥的，比如 <code>SimSun</code> 就叫 <code>宋体</code>……当然了最后就是玩了一下 <code>fontconfig</code> 的配置以后，默默就放弃了。</p>
<p>最后经过 <a href="https://github.com/felixonmars"  class="external-link" target="_blank" rel="noopener">@felixonmars</a> 同学的排查，发现是上游的一个 <a href="https://bugs.freedesktop.org/show_bug.cgi?id=105756"  class="external-link" target="_blank" rel="noopener">bug</a> ，而且已经修复，所以赶紧更了一波，解决了这个问题。</p>
<p>本以为皆大欢喜了，今天又有客户报过来 bug，说 Windows 上写好的文档，调整好的字体，跑到deepin下字体就不对了，废了老大的劲儿才又调好，其中就提到了选择方正字库里面的字体，显示的不是中文字体名称的问题。</p>
<p>怎么说呢，幸亏我脑子不好，不记得之前已经解决过中文字体名显示为英文的问题，要不然得跟客户和老板掰扯一会儿，我只记得字体的中英文名字好像是有点问题，所以默默赶紧去看了一下，还真真的有问题。</p>
<p>因为 DDE 并没有设置过多的 <code>fontconfig</code> 配置，所以我相信这不是 DDE 的问题，但是又觉得对于一个文字处理软件来说，如果这么重要的功能都有 BUG，我真不信 WPS 的人还能坐得住，所以就想试一下在 Ubuntu 下 WPS 的这个行为是否正确。刚好年前 ElementryOS 发新版的时候尝鲜装了一个在测试机器上，所以很快切进去下了一个 WPS 安装上，从一个正版的网站上下载了一个盗版的宋体，试了一下，果然踏马的是好的……</p>
<p>理性的我用事实证明了感性的我是错误的，气氛一度很尴尬。</p>
<p>更让人尴尬的是，我也不知道这是怎么回事。但是，无巧不成书，就在这种尴尬氛围的笼罩下，我鬼使神差地在 ElementryOS （太长了，下面简称 EOS ）上运行了 <code>fc-match 宋体</code> 这个命令，而且很神奇的发现输出的 <code>simsun.ttf: &quot;宋体&quot; &quot;Regular&quot;</code> 跟 deepin 下同样命令输出的 <code>simsun.ttf: &quot;SimSun&quot; &quot;Regular&quot;</code> 不太一样，这可把我乐坏了——要知道一个稍微复杂点的图形软件，打开 <code>fontconfig</code> 的调试以后，输出就是很可怕的，更别说 WPS！别问我是怎么知道的，回忆起来都是泪。但是现在使用 <code>fc-match</code> 就能重现的问题（我打心底认为这俩是同一个问题），调试起来就比较简单了。</p>
<p><code>fontconfig</code> 本身为了方便程序调试，内建了一些调试项，可以通过环境变量 <code>FC_DEBUG</code> 控制：</p>
<pre tabindex="0"><code>Name         Value    Meaning
  ---------------------------------------------------------
  MATCH            1    Brief information about font matching
  MATCHV           2    Extensive font matching information
  EDIT             4    Monitor match/test/edit execution
  FONTSET          8    Track loading of font information at startup
  CACHE           16    Watch cache files being written
  CACHEV          32    Extensive cache file writing information
  PARSE           64    (no longer in use)
  SCAN           128    Watch font files being scanned to build caches
  SCANV          256    Verbose font file scanning information
  MEMORY         512    Monitor fontconfig memory usage
  CONFIG        1024    Monitor which config files are loaded
  LANGSET       2048    Dump char sets used to construct lang values
  MATCH2        4096    Display font-matching transformation in patterns
</code></pre><p>我们只需要最简略的匹配信息就可以了，所以：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="nv">FC_DEBUG</span><span class="o">=</span><span class="m">1</span> fc-match 宋体
</span></span><span class="line"><span class="cl"><span class="nv">FC_DEBUG</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">Match Pattern has <span class="m">25</span> elts <span class="o">(</span>size 32<span class="o">)</span>
</span></span><span class="line"><span class="cl">	family: <span class="s2">&#34;宋体&#34;</span><span class="o">(</span>s<span class="o">)</span> <span class="s2">&#34;Noto Sans CJK SC&#34;</span><span class="o">(</span>s<span class="o">)</span> <span class="s2">&#34;Noto Sans&#34;</span><span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	familylang: <span class="s2">&#34;en&#34;</span><span class="o">(</span>s<span class="o">)</span> <span class="s2">&#34;en-us&#34;</span><span class="o">(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	stylelang: <span class="s2">&#34;en&#34;</span><span class="o">(</span>s<span class="o">)</span> <span class="s2">&#34;en-us&#34;</span><span class="o">(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	fullnamelang: <span class="s2">&#34;en&#34;</span><span class="o">(</span>s<span class="o">)</span> <span class="s2">&#34;en-us&#34;</span><span class="o">(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	slant: 0<span class="o">(</span>i<span class="o">)(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	weight: 80<span class="o">(</span>i<span class="o">)(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	width: 100<span class="o">(</span>i<span class="o">)(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	size: 12<span class="o">(</span>f<span class="o">)(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	pixelsize: 12.5<span class="o">(</span>f<span class="o">)(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	hintstyle: 1<span class="o">(</span>i<span class="o">)(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	hinting: True<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	verticallayout: False<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	autohint: False<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	globaladvance: True<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	dpi: 75<span class="o">(</span>f<span class="o">)(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	scale: 1<span class="o">(</span>f<span class="o">)(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	lang: <span class="s2">&#34;zh-CN&#34;</span><span class="o">(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	fontversion: 2147483647<span class="o">(</span>i<span class="o">)(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	embeddedbitmap: True<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	decorative: False<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	lcdfilter: 1<span class="o">(</span>i<span class="o">)(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	namelang: <span class="s2">&#34;en&#34;</span><span class="o">(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	prgname: <span class="s2">&#34;fc-match&#34;</span><span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	symbol: False<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	variable: False<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Best score <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> 1e+99 <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> 2.14735e+12
</span></span><span class="line"><span class="cl">Pattern has <span class="m">25</span> elts <span class="o">(</span>size 25<span class="o">)</span>
</span></span><span class="line"><span class="cl">	family: <span class="s2">&#34;SimSun&#34;</span><span class="o">(</span>w<span class="o">)</span> <span class="s2">&#34;宋体&#34;</span><span class="o">(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	familylang: <span class="s2">&#34;en&#34;</span><span class="o">(</span>w<span class="o">)</span> <span class="s2">&#34;zh-cn&#34;</span><span class="o">(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	style: <span class="s2">&#34;Regular&#34;</span><span class="o">(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	stylelang: <span class="s2">&#34;en&#34;</span><span class="o">(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	fullname: <span class="s2">&#34;SimSun&#34;</span><span class="o">(</span>w<span class="o">)</span> <span class="s2">&#34;宋体&#34;</span><span class="o">(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	fullnamelang: <span class="s2">&#34;en&#34;</span><span class="o">(</span>w<span class="o">)</span> <span class="s2">&#34;zh-cn&#34;</span><span class="o">(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	slant: 0<span class="o">(</span>i<span class="o">)(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	weight: 80<span class="o">(</span>f<span class="o">)(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	width: 100<span class="o">(</span>f<span class="o">)(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	spacing: 90<span class="o">(</span>i<span class="o">)(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	foundry: <span class="s2">&#34;ZYEC&#34;</span><span class="o">(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	file: <span class="s2">&#34;/home/hualet/.fonts/simsun.ttf&#34;</span><span class="o">(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	index: 0<span class="o">(</span>i<span class="o">)(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	outline: True<span class="o">(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	scalable: True<span class="o">(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	charset: 
</span></span><span class="line"><span class="cl">	0000: <span class="m">00000000</span> ffffffff ffffffff ffffffff <span class="m">00000000</span> ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0001: <span class="m">08080002</span> <span class="m">00000800</span> 000c2110 <span class="m">01000803</span> <span class="m">00040000</span> <span class="m">00000000</span> <span class="m">15554000</span> <span class="m">00000000</span>
</span></span><span class="line"><span class="cl">	0002: <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00020000</span> <span class="m">00000002</span> <span class="m">00000000</span> <span class="m">00000000</span> 12000ec0 <span class="m">00000000</span>
</span></span><span class="line"><span class="cl">	0003: <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span> fffe0000 fffe03fb 000003fb <span class="m">00000000</span>
</span></span><span class="line"><span class="cl">	0004: ffff0002 ffffffff 0002ffff <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span>
</span></span><span class="line"><span class="cl">	0020: <span class="m">77790000</span> 0e2d0067 <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00001000</span> <span class="m">00000000</span> <span class="m">00000000</span>
</span></span><span class="line"><span class="cl">	0021: <span class="m">00400228</span> <span class="m">00000006</span> <span class="m">00000000</span> 03ff0fff 03cf0000 <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span>
</span></span><span class="line"><span class="cl">	0022: e4228100 20f04fa9 <span class="m">00041100</span> 0000c0f3 <span class="m">02200000</span> <span class="m">80000020</span> <span class="m">00000000</span> <span class="m">00000000</span>
</span></span><span class="line"><span class="cl">	0023: <span class="m">00040000</span> <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span>
</span></span><span class="line"><span class="cl">	0024: <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span> fff003ff 0fffffff <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span>
</span></span><span class="line"><span class="cl">	0025: ffffffff ffffffff ffff0fff 000fffff 0038fffe 300c0003 0000c8c0 0000003c
</span></span><span class="line"><span class="cl">	0026: <span class="m">00000260</span> <span class="m">00000000</span> <span class="m">00000005</span> <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span>
</span></span><span class="line"><span class="cl">	0030: 60ffffef 000003fe fffffffe ffffffff 780fffff fffffffe ffffffff 707fffff
</span></span><span class="line"><span class="cl">	0031: ffffffe0 000003ff <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span>
</span></span><span class="line"><span class="cl">	0032: <span class="m">00000000</span> 000203ff <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000008</span> <span class="m">00000000</span> <span class="m">00000000</span>
</span></span><span class="line"><span class="cl">	0033: <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span> 7000c000 <span class="m">00000002</span> <span class="m">00264010</span> <span class="m">00000000</span>
</span></span><span class="line"><span class="cl">	004e: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	004f: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0050: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0051: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0052: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0053: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0054: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0055: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0056: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0057: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0058: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0059: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	005a: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	005b: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	005c: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	005d: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	005e: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	005f: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0060: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0061: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0062: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0063: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0064: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0065: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0066: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0067: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0068: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0069: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	006a: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	006b: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	006c: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	006d: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	006e: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	006f: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0070: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0071: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0072: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0073: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0074: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0075: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0076: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0077: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0078: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0079: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	007a: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	007b: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	007c: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	007d: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	007e: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	007f: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0080: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0081: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0082: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0083: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0084: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0085: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0086: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0087: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0088: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0089: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	008a: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	008b: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	008c: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	008d: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	008e: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	008f: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0090: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0091: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0092: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0093: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0094: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0095: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0096: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0097: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0098: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	0099: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	009a: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	009b: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	009c: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	009d: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	009e: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
</span></span><span class="line"><span class="cl">	009f: ffffffff ffffffff ffffffff ffffffff ffffffff 0000003f <span class="m">00000000</span> <span class="m">00000000</span>
</span></span><span class="line"><span class="cl">	00e7: <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000180</span> 000fff80
</span></span><span class="line"><span class="cl">	00e8: ffe00000 ffffffff ffffffff 0000001f <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span>
</span></span><span class="line"><span class="cl">	00f9: <span class="m">00000000</span> <span class="m">00001000</span> <span class="m">00000000</span> <span class="m">02000000</span> <span class="m">00200000</span> <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00020080</span>
</span></span><span class="line"><span class="cl">	00fa: 811af000 0000039b <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span>
</span></span><span class="line"><span class="cl">	00fe: <span class="m">00000000</span> fffb0000 fef7fe1f 00000f7f <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span>
</span></span><span class="line"><span class="cl">	00ff: fffffffe ffffffff 7fffffff <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span> <span class="m">00000000</span> 0000003f
</span></span><span class="line"><span class="cl"><span class="o">(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	lang: aa<span class="p">|</span>ay<span class="p">|</span>bg<span class="p">|</span>bi<span class="p">|</span>br<span class="p">|</span>ch<span class="p">|</span>co<span class="p">|</span>da<span class="p">|</span>de<span class="p">|</span>en<span class="p">|</span>es<span class="p">|</span>eu<span class="p">|</span>fj<span class="p">|</span>fo<span class="p">|</span>fr<span class="p">|</span>fur<span class="p">|</span>fy<span class="p">|</span>gd<span class="p">|</span>gl<span class="p">|</span>gv<span class="p">|</span>ho<span class="p">|</span>ia<span class="p">|</span>id<span class="p">|</span>ie<span class="p">|</span>io<span class="p">|</span>is<span class="p">|</span>it<span class="p">|</span>kum<span class="p">|</span>lb<span class="p">|</span>mg<span class="p">|</span>nb<span class="p">|</span>nds<span class="p">|</span>nl<span class="p">|</span>nn<span class="p">|</span>no<span class="p">|</span>nr<span class="p">|</span>nso<span class="p">|</span>oc<span class="p">|</span>om<span class="p">|</span>os<span class="p">|</span>pt<span class="p">|</span>rm<span class="p">|</span>ru<span class="p">|</span>sel<span class="p">|</span>sma<span class="p">|</span>smj<span class="p">|</span>so<span class="p">|</span>sq<span class="p">|</span>ss<span class="p">|</span>st<span class="p">|</span>sv<span class="p">|</span>sw<span class="p">|</span>tl<span class="p">|</span>tn<span class="p">|</span>ts<span class="p">|</span>uz<span class="p">|</span>vo<span class="p">|</span>wa<span class="p">|</span>xh<span class="p">|</span>yap<span class="p">|</span>zh-cn<span class="p">|</span>zh-sg<span class="p">|</span>zu<span class="p">|</span>an<span class="p">|</span>fil<span class="p">|</span>ht<span class="p">|</span>jv<span class="p">|</span>kj<span class="p">|</span>kwm<span class="p">|</span>li<span class="p">|</span>ms<span class="p">|</span>ng<span class="p">|</span>pap-an<span class="p">|</span>pap-aw<span class="p">|</span>rn<span class="p">|</span>rw<span class="p">|</span>sc<span class="p">|</span>sg<span class="p">|</span>sn<span class="p">|</span>su<span class="p">|</span>za<span class="o">(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	fontversion: 131072<span class="o">(</span>i<span class="o">)(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	capability: <span class="s2">&#34;otlayout:hani&#34;</span><span class="o">(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	fontformat: <span class="s2">&#34;TrueType&#34;</span><span class="o">(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	decorative: False<span class="o">(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	postscriptname: <span class="s2">&#34;SimSun&#34;</span><span class="o">(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	color: False<span class="o">(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	symbol: False<span class="o">(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	variable: False<span class="o">(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">simsun.ttf: <span class="s2">&#34;SimSun&#34;</span> <span class="s2">&#34;Regular&#34;</span>
</span></span></code></pre></div><p>因为以前调 <code>fontconfig</code> 的经验，我模模糊糊知道那个 <code>familylang</code> 是控制 <code>family</code> 也就是字体名显示的语言的，所以看到</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">familylang: <span class="s2">&#34;en&#34;</span><span class="o">(</span>s<span class="o">)</span> <span class="s2">&#34;en-us&#34;</span><span class="o">(</span>w<span class="o">)</span>
</span></span></code></pre></div><p>这行以后，大致能确定应该是系统某个配置出了问题让 <code>fontconfig</code> 误以为语言环境是英文。看了一下环境变量，没发现哪个是设置英文的，所以只能去看代码了。</p>
<p>下了 <code>fontconfig</code> 的源码，搜了一下关键字 <code>familylang</code> ，猜测这个属性应该是通过操纵 <code>FC_FAMILYLANG_OBJECT</code> ，再次搜索：</p>
<pre tabindex="0"><code> $ rg -i FC_FAMILYLANG_OBJECT
src/fcmatch.c
380:	case FC_FAMILYLANG_OBJECT:
551:	if (fe-&gt;object == FC_FAMILYLANG_OBJECT ||
565:	    FC_ASSERT_STATIC ((FC_FAMILY_OBJECT + 1) == FC_FAMILYLANG_OBJECT);
695:	    pe-&gt;object != FC_FAMILYLANG_OBJECT &amp;&amp;

src/fclist.c
430:		familyidx = FcGetDefaultObjectLangIndex (font, FC_FAMILYLANG_OBJECT, lang);

src/fcfreetype.c
1671:	    while (FcPatternObjectGetString (pat, FC_FAMILYLANG_OBJECT, n, &amp;familylang) == FcResultMatch)

src/fcdefault.c
316:    if (!FcPatternFindObjectIter (pattern, &amp;iter, FC_FAMILYLANG_OBJECT))
318:	FcPatternObjectAdd (pattern, FC_FAMILYLANG_OBJECT, namelang, FcTrue);
319:	FcPatternObjectAddWithBinding (pattern, FC_FAMILYLANG_OBJECT, v2, FcValueBindingWeak, FcTrue);
</code></pre><p>发现其中只有 <code>fcdefault.c</code> 里面有执行 <code>FcPatternObjectAdd</code> 这个操作像是在修改这个属性，其他地方明显都只是读取，刚好 <code>fc-match/fc-match.c</code> 里面也有调用这个函数，所以仔细看了一下这个函数，从逻辑上看意思是 <code>familylang</code> 如果没有设置，就会从 <code>namelang</code> 属性继承，然后我忽然发现 <code>fc-match</code> 的帮助里面写得位置参数概念上叫 <code>pattern</code> ，难道就对应 <code>FcPattern</code>，那它应该也可以指定 <code>familylang</code> 咯？网上搜寻了一番，发现可以 <code>fc-match 宋体:familylang=zh-cn</code>，果然输出正常的中文名。这算是一个小插曲吧。</p>
<p>接着 <code>namelang</code> 属性说，这个属性是从一个叫 <code>FcGetDefaultLang</code> 的函数处获取，我心想总算是要到头了，然而发现从函数的实现来看，这个函数会从 <code>FC_LANG</code>、<code>LC_ALL</code>、<code>LC_CTYPE</code>和<code>LANG</code>这些环境变量里面挨个读取默认的语言（后来发现直接 <code>man FcGetDefaultlangs</code> 就可以看到），看起来没毛病呀。</p>
<p>写了个测试程序：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;fontconfig/fontconfig.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">FcStrSet</span> <span class="o">*</span><span class="n">langs</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">langs</span> <span class="o">=</span> <span class="nf">FcGetDefaultLangs</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">langs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">FcChar8</span> <span class="o">*</span><span class="n">lang</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">FcStrList</span> <span class="o">*</span><span class="n">lang_list</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">lang_list</span> <span class="o">=</span> <span class="nf">FcStrListCreate</span><span class="p">(</span><span class="n">langs</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">FcStrListFirst</span><span class="p">(</span><span class="n">lang_list</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">while</span><span class="p">(</span><span class="n">lang</span> <span class="o">=</span> <span class="nf">FcStrListNext</span><span class="p">(</span><span class="n">lang_list</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;%s&#34;</span><span class="p">,</span> <span class="n">lang</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>编译执行，输出 <code>zh-CN</code> ，666</p>
<p>中间尝试了使用 <code>gdb</code> 在 <code>fc-match.c</code>中调用 <code>FcDefaultSubstitute</code> 的部分加断点，但是死活无法跳入函数体里面，直接在函数里面响应的行数处断点，直接无效……撞鬼了</p>
<p>没办法了，只能改代码了，找了找代码里面的 log 模块叫 <code>fcdbg.c</code> ，我本来还说从 <code>FcPattern</code>  里面读取属性有点麻烦，又不熟悉代码，但是意外地找到一个 <code>FcPatternPrint</code> ，这下连继续研究下去的动力都没有了，赶紧加代码打印，分别在 <code>FcConfigSubstitute</code> 和 <code>FcDefaultSubstitute</code> 前后加了打印看对 <code>pat</code> 的代码：</p>
<pre tabindex="0"><code>	FcPatternPrint(pat);
    FcConfigSubstitute (0, pat, FcMatchPattern);
	FcPatternPrint(pat);
    FcDefaultSubstitute (pat);
	FcPatternPrint(pat);
</code></pre><p>输出：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ ./fc-match 宋体
</span></span><span class="line"><span class="cl">Pattern has <span class="m">1</span> elts <span class="o">(</span>size 16<span class="o">)</span>
</span></span><span class="line"><span class="cl">	family: <span class="s2">&#34;宋体&#34;</span><span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Pattern has <span class="m">6</span> elts <span class="o">(</span>size 16<span class="o">)</span>
</span></span><span class="line"><span class="cl">	family: <span class="s2">&#34;宋体&#34;</span><span class="o">(</span>s<span class="o">)</span> <span class="s2">&#34;Noto Sans CJK SC&#34;</span><span class="o">(</span>s<span class="o">)</span> <span class="s2">&#34;Noto Sans&#34;</span><span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	hintstyle: 1<span class="o">(</span>i<span class="o">)(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	lang: <span class="s2">&#34;zh-CN&#34;</span><span class="o">(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	lcdfilter: 1<span class="o">(</span>i<span class="o">)(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	namelang: <span class="s2">&#34;en&#34;</span><span class="o">(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	prgname: <span class="s2">&#34;fc-match&#34;</span><span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Pattern has <span class="m">25</span> elts <span class="o">(</span>size 32<span class="o">)</span>
</span></span><span class="line"><span class="cl">	family: <span class="s2">&#34;宋体&#34;</span><span class="o">(</span>s<span class="o">)</span> <span class="s2">&#34;Noto Sans CJK SC&#34;</span><span class="o">(</span>s<span class="o">)</span> <span class="s2">&#34;Noto Sans&#34;</span><span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	familylang: <span class="s2">&#34;en&#34;</span><span class="o">(</span>s<span class="o">)</span> <span class="s2">&#34;en-us&#34;</span><span class="o">(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	stylelang: <span class="s2">&#34;en&#34;</span><span class="o">(</span>s<span class="o">)</span> <span class="s2">&#34;en-us&#34;</span><span class="o">(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	fullnamelang: <span class="s2">&#34;en&#34;</span><span class="o">(</span>s<span class="o">)</span> <span class="s2">&#34;en-us&#34;</span><span class="o">(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	slant: 0<span class="o">(</span>i<span class="o">)(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	weight: 80<span class="o">(</span>i<span class="o">)(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	width: 100<span class="o">(</span>i<span class="o">)(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	size: 12<span class="o">(</span>f<span class="o">)(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	pixelsize: 12.5<span class="o">(</span>f<span class="o">)(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	hintstyle: 1<span class="o">(</span>i<span class="o">)(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	hinting: True<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	verticallayout: False<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	autohint: False<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	globaladvance: True<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	dpi: 75<span class="o">(</span>f<span class="o">)(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	scale: 1<span class="o">(</span>f<span class="o">)(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	lang: <span class="s2">&#34;zh-CN&#34;</span><span class="o">(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	fontversion: 2147483647<span class="o">(</span>i<span class="o">)(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	embeddedbitmap: True<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	decorative: False<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	lcdfilter: 1<span class="o">(</span>i<span class="o">)(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	namelang: <span class="s2">&#34;en&#34;</span><span class="o">(</span>w<span class="o">)</span>
</span></span><span class="line"><span class="cl">	prgname: <span class="s2">&#34;fc-match&#34;</span><span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	symbol: False<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">	variable: False<span class="o">(</span>s<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">simsun.ttf: <span class="s2">&#34;SimSun&#34;</span> <span class="s2">&#34;Regular&#34;</span>
</span></span></code></pre></div><p>可以确认是 <code>FcConfigSubstitute</code> 函数里面给 <code>pat</code> 设置了 <code>en</code> 的 <code>namelang</code>，那之后在 <code>FcDefaultSubstitute</code> 中 <code>familylang</code>  就从 <code>namelang</code> 继承了 <code>en</code> ，又加上了 <code>en-us</code> ，变成了我们看到的 <code>&quot;en&quot;，&quot;en-us&quot;</code> 。看函数名， <code>FcConfigSubstitute</code> 应该就是读取了配置文件，然后做了什么修改，至于怎么改的我也不知道。</p>
<p>这时候我偷懒症犯了，没有去看代码了（看着略复杂），我发现新版 <code>fontconfig</code> 多了一个工具叫 <code>fc-conflist</code> 能列出来 <code>fontconfig</code> 加载的所有配置文件列表，通过这个命令我发现系统里面的配置文件主要放在 <code>/etc/fonts</code> 和 <code>/usr/share/fontconfig</code> ，然后就用 <code>rg</code> 去里面搜关键字 <code>lang</code> 了，排除其中 <code>&lt;test&gt;</code> 的行，还真发现一个叫 <code>/usr/share/conf.avail/15-assign-lang-en.conf</code> 的文件里面有 <code>edit</code> <code>namelang</code> 这个属性，在此之前，我都不知道还有 <code>edit</code> 这种操作……我也更不信这个问题会出在 <code>fontconfig</code> 的配置上。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ dpkg -S conf.avail/15-assign-lang-en.conf
</span></span><span class="line"><span class="cl">deepin-default-settings: /usr/share/fontconfig/conf.avail/15-assign-lang-en.conf
</span></span></code></pre></div><p>事实证明，这个配置文件还真是 deepin 提供的……</p>
<p>本来想搞清楚之前为什么要做这个的，但是提交信息太简单了，没有提供相关线索，猜测应该是以前有些字体名称会乱码——字体名称需要特殊字体的支持，然而系统（终端）的字体不支持这种字体的字体名，为了解决乱码，默认使用英文输出字体名称 😅</p>
<p>不过有了 Noto 这种问题应该就很少了，所以狠心删掉了这个配置：<a href="https://github.com/linuxdeepin/default-settings/commit/34ce7928e70f082b02a7da7e60a9ddaaf7a036f4"  class="external-link" target="_blank" rel="noopener">提交</a>。</p>
<p>结合这两个问题，猜测 WPS 字体设置分两个部分，一部分是从系统获取字体列表，这个部分是从 Qt 拿的，用的 Qt 提供的字体名（中文），第二部分是从这个字体名拿到系统中匹配度最高的字体，应该是通过 <code>libfontconfig</code> 直接做得（deepin下英文），然后再把这个字体设置给实际的文档，工具栏中显示的也就是这个名字。总之，人家又不开源，瞎猜一下图个开心咯。</p>

  </article>
</section>

  

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
      2019 -
    
    2024
     John Doe 
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.js"></script>
  

  

  


  
  



  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>

</html>
